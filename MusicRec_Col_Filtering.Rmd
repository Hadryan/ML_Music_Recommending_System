---
title: "MusicRec_Col_Filtering"
author: "Yitong Chen"
date: "10/25/2020"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(softImpute)
```



```{r}
Songs <- read.csv("Songs.csv", sep = ",")
MusicRatings <- read.csv("MusicRatings.csv", sep = ",")
Users <- read.csv("Users.csv", sep = ",")
```

Load the data and calculate some summary statistics
```{r}

paste("Total Songs:", nrow(unique(MusicRatings["songID"])))

paste("Total users:", nrow(unique(Users)))

paste("Range of ratings: (" ,min(MusicRatings["rating"]),",",max(MusicRatings["rating"]),")")
```

1. ## Train Test Split
#### a) Training set with 84% of the observations.<br/>
#### b) Validation set A to be used for tuning the collaborative filtering model, with 4% of the observations.<br/>
#### c) Validation set B to be used for blending, with 4% of the observations.
#### d) Testing set with 8% of the observations
```{r}
set.seed(345)
train.ids <- sample(nrow(MusicRatings), 0.92*nrow(MusicRatings))
train <- MusicRatings[train.ids,]
test <- MusicRatings[-train.ids,]


## split out the validation part
val.ids <- sample(nrow(train), (8/92)*nrow(train))
val <- train[val.ids,]

## update train set
train <- train[-val.ids,]

## get valA and val B
valA.ids <- sample(nrow(val), 0.5*nrow(val))
valA <- val[valA.ids,]
valB <- val[-valA.ids,]
```

#### e) construct an incomplet training set ratings matrix.
```{r}
mat.train <- Incomplete(train$userID, train$songID, train$rating)

paste("Dimension of the matrix", dim(mat.train)[1], "*", dim(mat.train)[2])
```

## 2. Models
Let $X$ denote the “complete” ratings matrix, i.e., $X_{i,j}$ denotes either the observed
rating if user i actually rated song j or the “hypothetical” such rating if user i has not yet
rated song j. We are interested in predicting the values of $X_{i,j}$ that are not observed. Let us
first consider the following model: <br/>
\center __$X_{i,j} = \alpha_{i} + \beta_{j} + \epsilon_{i,j}$__ \center <br/>

where $\alpha_i$ is a coefficient that depends only on the particular row i (i.e., user), "j is a coefficient
that depends only on the particular column j (i.e., song), and $\epsilon_{i,j}$ is a noise term.

#### i) Parameters
There are two types of parameters in this model $\alpha$ and $\beta$; A total of 2421 $\alpha$ and 807 $\beta$. So there are 3228 parameters to fit. <br/>
There're 243104 observations in the training set, so we'll train the model with 243104 observations and fill in the rest of the matrix.
















